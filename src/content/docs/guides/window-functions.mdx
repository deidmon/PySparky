---
title: Funciones de ventana (Window Functions)
description: CÃ³mo usar window functions en PySpark.
---

Las funciones de ventana permiten realizar cÃ¡lculos sobre un conjunto de filas relacionadas a la fila actual, sin colapsar el DataFrame como lo harÃ­a una agregaciÃ³n normal.

### âœ… Â¿QuÃ© son las funciones de ventana?

* Permiten usar funciones de agregaciÃ³n sin reducir el nÃºmero de filas.
* Comparables a `OVER()` en SQL.
* Usadas para rankings, acumulados, diferencias entre filas, entre otros.

### ğŸ“Œ Componentes de una ventana

1. **Partition By** â€“ Divide los datos en grupos.
2. **Order By** â€“ Ordena las filas dentro de cada grupo.
3. **Frame Specification** â€“ Define el rango de filas a considerar (opcional).

```python
from pyspark.sql.window import Window
from pyspark.sql.functions import row_number, rank, dense_rank

window_spec = Window.partitionBy("categoria").orderBy("ventas")
```

### ğŸ’¡ Funciones mÃ¡s comunes

| FunciÃ³n | DescripciÃ³n |
|---|---|
| `row_number()` | NÃºmero consecutivo por grupo |
| `rank()` | Ranking con saltos en empates |
| `dense_rank()` | Ranking sin saltos |
| `lag()` | Valor anterior de una fila |
| `lead()` | Valor siguiente de una fila |
| `sum()` | Acumulado por grupo |
| `avg()` | Promedio por grupo |

```python
from pyspark.sql.functions import lag, lead, sum

window_spec = Window.partitionBy("cliente").orderBy("fecha")

df.withColumn("ventas_previas", lag("ventas", 1).over(window_spec))
```

### ğŸ” Ejemplo prÃ¡ctico

```python
data = [("A", "2024-01-01", 100), ("A", "2024-01-02", 200),
        ("B", "2024-01-01", 50), ("B", "2024-01-02", 80)]

cols = ["cliente", "fecha", "ventas"]
df = spark.createDataFrame(data, cols)

window_spec = Window.partitionBy("cliente").orderBy("fecha")
df = df.withColumn("acumulado", sum("ventas").over(window_spec))
df.show()
```

### ğŸ“Œ Buenas prÃ¡cticas

* Siempre especifica orden y particiÃ³n claramente.
* Cuidado con el tamaÃ±o del frame si estÃ¡s trabajando con millones de filas.
* Evita usar `orderBy` global dentro de la ventana si no es necesario.

### ğŸ“Š Â¿DÃ³nde se usa?

* AnÃ¡lisis temporal.
* CÃ¡lculos acumulativos.
* Rankings dentro de grupos.
* ComparaciÃ³n entre registros consecutivos.